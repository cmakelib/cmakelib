##
#
# Test CMLIB_PARSE_ARGUMENTS argument type validation including OPTIONS behavior
# with explicit values, ONE_VALUE edge cases with empty/undefined values,
# MULTI_VALUE handling with single/multiple items, and REQUIRED argument enforcement.
#

IF(NOT DEFINED CMAKE_SCRIPT_MODE_FILE)
	CMAKE_MINIMUM_REQUIRED(VERSION 3.18)
	PROJECT(CMLIB_PARSE_ARGUMENTS_ARGUMENT_TYPES_TEST)
ENDIF()

LIST(APPEND CMAKE_MODULE_PATH "${CMAKE_CURRENT_LIST_DIR}/../../../../")
FIND_PACKAGE(CMLIB REQUIRED)

INCLUDE("${CMAKE_CURRENT_LIST_DIR}/../../../TEST.cmake")

FUNCTION(TEST_OPTIONS_VALIDATION)
	CMLIB_PARSE_ARGUMENTS(
		OPTIONS OPT_TRUE OPT_FALSE OPT_UNSET OPT_OFF
		P_ARGN
			OPT_TRUE ON
			OPT_FALSE OFF
			OPT_OFF OFF
	)

	TEST_VAR_TRUE(__OPT_TRUE)
	TEST_VAR_FALSE(__OPT_FALSE)
	TEST_VAR_FALSE(__OPT_OFF)
	TEST_VAR_FALSE(__OPT_UNSET)
ENDFUNCTION()

FUNCTION(TEST_ONE_VALUE_EDGE_CASES)
	CMLIB_PARSE_ARGUMENTS(
		ONE_VALUE SINGLE_EMPTY SINGLE_VALUE SINGLE_UNSET
		P_ARGN
			SINGLE_EMPTY ""
			SINGLE_VALUE "actual_value"
	)

	TEST_VAR_EQUALS_LITERAL(__SINGLE_VALUE "actual_value")
	TEST_VAR_NOT_DEFINED(__SINGLE_UNSET)

	IF(DEFINED __SINGLE_EMPTY)
		TEST_VAR_EQUALS_LITERAL(__SINGLE_EMPTY "")
	ENDIF()

	CMLIB_PARSE_ARGUMENTS(
		ONE_VALUE TEST_SINGLE
		P_ARGN
			TEST_SINGLE "value1" "value2"
	)

	TEST_VAR_EQUALS_LITERAL(__TEST_SINGLE "value1")
ENDFUNCTION()

FUNCTION(TEST_MULTI_VALUE_EDGE_CASES)
	CMLIB_PARSE_ARGUMENTS(
		MULTI_VALUE MULTI_SINGLE MULTI_MULTIPLE MULTI_EMPTY
		P_ARGN
			MULTI_SINGLE "single_item"
			MULTI_MULTIPLE "item1" "item2" "item3"
	)

	TEST_VAR_DEFINED(__MULTI_SINGLE)
	LIST(LENGTH __MULTI_SINGLE single_length)
	SET(expected_single_length 1)
	TEST_VAR_EQUAL(single_length expected_single_length)

	LIST(GET __MULTI_SINGLE 0 single_item)
	TEST_VAR_EQUALS_LITERAL(single_item "single_item")

	TEST_VAR_DEFINED(__MULTI_MULTIPLE)
	LIST(LENGTH __MULTI_MULTIPLE multiple_length)
	SET(expected_multiple_length 3)
	TEST_VAR_EQUAL(multiple_length expected_multiple_length)

	LIST(GET __MULTI_MULTIPLE 1 second_item)
	TEST_VAR_EQUALS_LITERAL(second_item "item2")

	TEST_VAR_NOT_DEFINED(__MULTI_EMPTY)
ENDFUNCTION()

FUNCTION(TEST_REQUIRED_ENFORCEMENT)
	CMLIB_PARSE_ARGUMENTS(
		ONE_VALUE REQ_SINGLE
		MULTI_VALUE REQ_MULTI
		OPTIONS REQ_OPTION
		REQUIRED REQ_SINGLE REQ_MULTI REQ_OPTION
		P_ARGN
			REQ_SINGLE "required_value"
			REQ_MULTI "req1" "req2"
			REQ_OPTION ON
	)

	TEST_VAR_EQUALS_LITERAL(__REQ_SINGLE "required_value")

	TEST_VAR_DEFINED(__REQ_MULTI)
	LIST(LENGTH __REQ_MULTI req_multi_length)
	SET(expected_req_multi_length 2)
	TEST_VAR_EQUAL(req_multi_length expected_req_multi_length)

	TEST_VAR_TRUE(__REQ_OPTION)
ENDFUNCTION()



TEST_OPTIONS_VALIDATION()
TEST_ONE_VALUE_EDGE_CASES()
TEST_MULTI_VALUE_EDGE_CASES()
TEST_REQUIRED_ENFORCEMENT()
